import { describe, expect, it } from "vitest";

import {
  cut,
  cutAll,
  cutForSearch,
  cutHMM,
  cutSmall,
  insertWord,
  tag,
  extract,
  textRankExtract,
} from "../src/index.js";

const sentence =
  "æˆ‘æ˜¯æ‹–æ‹‰æœºå­¦é™¢æ‰‹æ‰¶æ‹–æ‹‰æœºä¸“ä¸šçš„ã€‚ä¸ç”¨å¤šä¹…ï¼Œæˆ‘å°±ä¼šå‡èŒåŠ è–ªï¼Œå½“ä¸ŠCEOï¼Œèµ°ä¸Šäººç”Ÿå·…å³°ã€‚";

describe("nodejieba", () => {
  it("cut", () => {
    expect(cut("ä»Šå¤©å¤©æ°”å¾ˆå¥½ï¼ŒðŸ™‹ æˆ‘ä»¬åŽ»éƒŠæ¸¸ã€‚")).toEqual([
      "ä»Šå¤©å¤©æ°”",
      "å¾ˆ",
      "å¥½",
      "ï¼Œ",
      "ðŸ™‹",
      " ",
      "æˆ‘ä»¬",
      "åŽ»",
      "éƒŠæ¸¸",
      "ã€‚",
    ]);

    expect(cut(sentence)).toEqual([
      "æˆ‘",
      "æ˜¯",
      "æ‹–æ‹‰æœº",
      "å­¦é™¢",
      "æ‰‹æ‰¶æ‹–æ‹‰æœº",
      "ä¸“ä¸š",
      "çš„",
      "ã€‚",
      "ä¸ç”¨",
      "å¤šä¹…",
      "ï¼Œ",
      "æˆ‘",
      "å°±",
      "ä¼š",
      "å‡èŒ",
      "åŠ è–ª",
      "ï¼Œ",
      "å½“",
      "ä¸Š",
      "C",
      "E",
      "O",
      "ï¼Œ",
      "èµ°ä¸Š",
      "äººç”Ÿ",
      "å·…å³°",
      "ã€‚",
    ]);

    expect(cut("è®¿é—®www.baidu.comè¿›è¡Œæœç´¢", true)).toEqual([
      "è®¿é—®",
      "www",
      ".",
      "baidu",
      ".",
      "com",
      "è¿›è¡Œ",
      "æœç´¢",
    ]);

    expect(cut(sentence, true)).toEqual([
      "æˆ‘",
      "æ˜¯",
      "æ‹–æ‹‰æœº",
      "å­¦é™¢",
      "æ‰‹æ‰¶æ‹–æ‹‰æœº",
      "ä¸“ä¸š",
      "çš„",
      "ã€‚",
      "ä¸ç”¨",
      "å¤šä¹…",
      "ï¼Œ",
      "æˆ‘",
      "å°±",
      "ä¼š",
      "å‡èŒ",
      "åŠ è–ª",
      "ï¼Œ",
      "å½“ä¸Š",
      "CEO",
      "ï¼Œ",
      "èµ°ä¸Š",
      "äººç”Ÿ",
      "å·…å³°",
      "ã€‚",
    ]);
  });

  it("cutHMM", () => {
    expect(cutHMM(sentence)).toEqual([
      "æˆ‘",
      "æ˜¯",
      "æ‹–æ‹‰æœº",
      "å­¦é™¢",
      "æ‰‹",
      "æ‰¶",
      "æ‹–æ‹‰æœº",
      "ä¸“ä¸š",
      "çš„",
      "ã€‚",
      "ä¸ç”¨",
      "å¤šä¹…",
      "ï¼Œ",
      "æˆ‘",
      "å°±",
      "ä¼šå‡",
      "èŒåŠ è–ª",
      "ï¼Œ",
      "å½“ä¸Š",
      "CEO",
      "ï¼Œ",
      "èµ°ä¸Š",
      "äººç”Ÿ",
      "å·…å³°",
      "ã€‚",
    ]);
  });

  it("cutAll", () => {
    expect(cutAll("å—äº¬å¸‚é•¿æ±Ÿå¤§æ¡¥")).toEqual([
      "å—äº¬",
      "å—äº¬å¸‚",
      "äº¬å¸‚",
      "å¸‚é•¿",
      "é•¿æ±Ÿ",
      "é•¿æ±Ÿå¤§æ¡¥",
      "å¤§æ¡¥",
    ]);

    expect(cutAll(sentence)).toEqual([
      "æˆ‘",
      "æ˜¯",
      "æ‹–æ‹‰",
      "æ‹–æ‹‰æœº",
      "å­¦é™¢",
      "æ‰‹æ‰¶",
      "æ‰‹æ‰¶æ‹–æ‹‰æœº",
      "æ‹–æ‹‰",
      "æ‹–æ‹‰æœº",
      "ä¸“ä¸š",
      "çš„",
      "ã€‚",
      "ä¸ç”¨",
      "å¤šä¹…",
      "ï¼Œ",
      "æˆ‘",
      "å°±",
      "ä¼šå‡",
      "å‡èŒ",
      "åŠ è–ª",
      "ï¼Œ",
      "å½“ä¸Š",
      "C",
      "E",
      "O",
      "ï¼Œ",
      "èµ°ä¸Š",
      "äººç”Ÿ",
      "å·…å³°",
      "ã€‚",
    ]);
  });

  it("cutSmall", () => {
    expect(cutSmall("å—äº¬å¸‚é•¿æ±Ÿå¤§æ¡¥", 2)).toEqual([
      "å—äº¬",
      "å¸‚",
      "é•¿æ±Ÿ",
      "å¤§æ¡¥",
    ]);
    expect(cutSmall("å—äº¬å¸‚é•¿æ±Ÿå¤§æ¡¥", 3)).toEqual(["å—äº¬å¸‚", "é•¿æ±Ÿ", "å¤§æ¡¥"]);
    expect(cutSmall("å—äº¬å¸‚é•¿æ±Ÿå¤§æ¡¥", 4)).toEqual(["å—äº¬å¸‚", "é•¿æ±Ÿå¤§æ¡¥"]);
  });

  it("cutForSearch", () => {
    expect(cutForSearch(sentence)).toEqual([
      "æˆ‘",
      "æ˜¯",
      "æ‹–æ‹‰",
      "æ‹–æ‹‰æœº",
      "å­¦é™¢",
      "æ‰‹æ‰¶",
      "æ‹–æ‹‰",
      "æ‹–æ‹‰æœº",
      "æ‰‹æ‰¶æ‹–æ‹‰æœº",
      "ä¸“ä¸š",
      "çš„",
      "ã€‚",
      "ä¸ç”¨",
      "å¤šä¹…",
      "ï¼Œ",
      "æˆ‘",
      "å°±",
      "ä¼š",
      "å‡èŒ",
      "åŠ è–ª",
      "ï¼Œ",
      "å½“",
      "ä¸Š",
      "C",
      "E",
      "O",
      "ï¼Œ",
      "èµ°ä¸Š",
      "äººç”Ÿ",
      "å·…å³°",
      "ã€‚",
    ]);
  });

  it("tag", () => {
    expect(tag(sentence)).toEqual([
      {
        tag: "r",
        word: "æˆ‘",
      },
      {
        tag: "v",
        word: "æ˜¯",
      },
      {
        tag: "n",
        word: "æ‹–æ‹‰æœº",
      },
      {
        tag: "n",
        word: "å­¦é™¢",
      },
      {
        tag: "n",
        word: "æ‰‹æ‰¶æ‹–æ‹‰æœº",
      },
      {
        tag: "n",
        word: "ä¸“ä¸š",
      },
      {
        tag: "uj",
        word: "çš„",
      },
      {
        tag: "x",
        word: "ã€‚",
      },
      {
        tag: "v",
        word: "ä¸ç”¨",
      },
      {
        tag: "m",
        word: "å¤šä¹…",
      },
      {
        tag: "x",
        word: "ï¼Œ",
      },
      {
        tag: "r",
        word: "æˆ‘",
      },
      {
        tag: "d",
        word: "å°±",
      },
      {
        tag: "v",
        word: "ä¼š",
      },
      {
        tag: "v",
        word: "å‡èŒ",
      },
      {
        tag: "nr",
        word: "åŠ è–ª",
      },
      {
        tag: "x",
        word: "ï¼Œ",
      },
      {
        tag: "t",
        word: "å½“ä¸Š",
      },
      {
        tag: "eng",
        word: "CEO",
      },
      {
        tag: "x",
        word: "ï¼Œ",
      },
      {
        tag: "v",
        word: "èµ°ä¸Š",
      },
      {
        tag: "n",
        word: "äººç”Ÿ",
      },
      {
        tag: "n",
        word: "å·…å³°",
      },
      {
        tag: "x",
        word: "ã€‚",
      },
    ]);
  });

  it("extract", () => {
    const result = extract(sentence, 5);

    expect(result).toEqual([
      {
        weight: 11.739204307083542,
        word: "CEO",
      },
      {
        weight: 10.8561552143,
        word: "å‡èŒ",
      },
      {
        weight: 10.642581114,
        word: "åŠ è–ª",
      },
      {
        weight: 10.0088573539,
        word: "æ‰‹æ‰¶æ‹–æ‹‰æœº",
      },
      {
        weight: 9.49395840471,
        word: "å·…å³°",
      },
    ]);
    expect(result.length).toEqual(5);
  });

  it("textRankExtract", () => {
    expect(textRankExtract(sentence, 5)).toEqual([
      {
        weight: 1,
        word: "å½“ä¸Š",
      },
      {
        weight: 0.9898479330698993,
        word: "ä¸ç”¨",
      },
      {
        weight: 0.9851260595435759,
        word: "å¤šä¹…",
      },
      {
        weight: 0.9830464899847804,
        word: "åŠ è–ª",
      },
      {
        weight: 0.9802777682279076,
        word: "å‡èŒ",
      },
    ]);
  });

  it("insertWord", () => {
    expect(cut("ç”·é»˜å¥³æ³ª")).toEqual(["ç”·", "é»˜", "å¥³", "æ³ª"]);

    insertWord("ç”·é»˜å¥³æ³ª");

    expect(cut("ç”·é»˜å¥³æ³ª")).toEqual(["ç”·é»˜å¥³æ³ª"]);
  });
});
